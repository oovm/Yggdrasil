package yggdrasil: {{ self.language_id() }};

world host {
    export ast;
}

interface ast {
    use peg: core/types.{parse-error};
    use peg: core/cst.{syntax-node, syntax-rule, text-range};

    /// Token type of the language
    enum {{ self.language_id() }}-token {
{%- for (variant, _) in self.token_type() %}
        %{{ variant }},
{%- endfor %}
        %hidden-text,
    }

    variant {{ self.language_id() }}-type {
{%- for (variant, class) in self.token_type() %}
        %{{ variant }}({{ self.language_id() }}-{{ class }}-node),
{%- endfor %}
    }
    parse-string: func(text: string, offset: u32, rule: {{ self.language_id() }}-token) -> result<{{ self.language_id() }}-type, parse-error>;

{%- for variant in self.grammar.unions() %}
    // AST Types
    variant {{ self.language_id() }}-{{ self.rule_name(variant) }}-node {
{%- for (item, class) in self.variant_items(variant) %}
        %{{ item }}({{ self.language_id() }}-{{ class }}-node),
{%- endfor %}
    }
{%- endfor %}

{%- for record in self.grammar.classes() %}
    resource {{ self.language_id() }}-{{ self.rule_name(record) }}-node {
        ctor: static func(super: syntax-node) -> result<{{ self.language_id() }}-{{ self.rule_name(record) }}-node, parse-error>;
        parse-string: static func(text: string, offset: u32) -> result<{{ self.language_id() }}-{{ self.rule_name(record) }}-node, parse-error>;
        get-rule: func() -> syntax-rule;
        get-string: func() -> string;
        get-range: func() -> text-range;
    }
{%- endfor %}
}

interface visitor {

}

interface listener {

}
